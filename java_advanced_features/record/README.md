
# Java Advanced Features ‚Äì Records

## üß© What Are Records?
Introduced to simplify creation of immutable data classes.

A record is a special kind of class that automatically:
- Declares private final fields for components.
- Generates:
    - Canonical constructor
    - Accessor methods (named after components)
    - equals(), hashCode(), toString()

### üß± Syntax
```java
public record Product(long id, String name, String description) {}
```

Equivalent to a verbose immutable class with:
- Final fields
- Constructor
- Getters
- equals, hashCode, toString

---

## üîí Immutability

### Definition
An immutable object‚Äôs state cannot change after construction.

### Benefits
- Easier reasoning & fewer bugs.
- Thread-safe without synchronization.
- Safe for use as HashMap keys / HashSet elements.
- Enables sharing & caching (e.g., String pool).

### Drawbacks
- Inefficient for frequent updates (e.g., string concatenation).
- Circular references impossible.
- Sometimes more object creation overhead.

---

## üß† Key Concepts in Records

### Components
Defined in record header:
```java
record Customer(long id, String name, String email) {}
```
Accessed via methods:
```java
customer.id(), customer.name()
```

---

## ‚öôÔ∏è Overriding Accessor Methods
- You can override accessors for custom logic.
- Use @Override annotation.
- ‚ö†Ô∏è Be careful: overridden accessors may cause inconsistencies in copies.

**Rules:**
- Must return same type as component.
- Cannot throw checked exceptions.

---

## üßæ Auto-Generated Methods
- `toString()` ‚Äì prints all components.
- `equals()` ‚Äì compares all components.
- `hashCode()` ‚Äì based on all components.
- Can be overridden (e.g., equality based only on id).

---

## üß± Constructors in Records

### 1. Canonical Constructor
Auto-generated by compiler.  
Matches component list exactly.  
Can be overridden for:
- Validation
- Defensive copies of mutable objects

Example:
```java
public record Order(
    long id, Customer customer,
    LocalDateTime dateTime, List<OrderLine> lines
) {
    public Order {
        Validation.checkThat(customer != null, "Customer required");
        this.lines = List.copyOf(lines); // defensive copy
    }
}
```

### 2. Compact Constructor
Shorter form of canonical constructor.  
Omits parameter list and field assignments (done automatically).
```java
public record Order(...) {
    public Order {
        lines = List.copyOf(lines);
        Validation.checkThat(!lines.isEmpty(), "At least one line required");
    }
}
```

### 3. Additional Constructors
Allowed if they call another constructor via `this(...)` as the first statement.  
Canonical constructor is always called first.

Example:
```java
public record Product(long id, String name, String desc) {
    public Product(long id, String name) {
        this(id, name, null);
    }
}
```
Can also use static factory methods for named creation.

---

## üß≠ Class Hierarchy
- Records are implicitly final (cannot be subclassed).
- Cannot extend other classes.
- Can implement interfaces.
- Superclass: `java.lang.Record ‚Üí java.lang.Object`

---

## üß∞ Practical Use Cases

### ‚úÖ Suitable For
- Domain objects (non-JPA)
- Value objects (e.g., EmailAddress, FullName)
- Data Transfer Objects (DTOs)

### üö´ Not Suitable For
- JPA Entities (require mutability, non-final fields)
- JavaBeans (get/set naming convention)
- Singletons (cannot make constructor private)

---

## üßë‚Äçüè≠ Builder Pattern for Records
Simplifies object creation with many parameters.  
Provides **fluent interface** (chained method calls).

Example:
```java
Order.builder()
    .withId(2001)
    .forCustomer(customer)
    .atDateTime(LocalDateTime.now())
    .addLine(line1)
    .addLine(line2)
    .build();
```
Improves readability but adds boilerplate (can use Lombok).

---

## üß© Wither Methods
Return **new modified copy** of immutable object.

Example:
```java
public OrderLine withPrice(BigDecimal newPrice) {
    return new OrderLine(product, quantity, newPrice);
}
```
Enable fluent updates:
```java
line.withQuantity(5).withPrice(9.99);
```
‚ö†Ô∏è Avoid inefficient copying (especially with collections).  
‚Üí Use Builder pattern instead for complex updates.

---

## üßæ Summary Cheat Sheet
| Concept | Key Point |
|----------|------------|
| Record | Concise immutable class |
| Components | Define fields + auto accessors |
| Accessors | Can override, same return type |
| Canonical Constructor | Auto-generated, can validate |
| Compact Constructor | Short form of canonical |
| Additional Constructors | Must call `this(...)` first |
| Class Hierarchy | Final, extends `java.lang.Record` |
| Use Cases | DTOs, Value Objects, Domain Models |
| Not For | JPA entities, JavaBeans, Singletons |
| Builder Pattern | Fluent, clear object creation |
| Wither Methods | Modified copies, avoid inefficiency |
